## Вопрос 4. Исходные и объектные модули, процессы компиляции и связывания (линковка)

**Компиляция** — сборка программы, включающая:
- трансляцию всех модулей программы, написанных на одном или нескольких исходных языках программирования высокого уровня и/или языке ассемблера, в эквивалентные программные модули на низкоуровневом языке, близком машинному коду (абсолютный код, объектный модуль, иногда на язык ассемблера) или непосредственно на машинном языке или ином двоичнокодовом низкоуровневом командном языке;
- последующую сборку исполняемой машинной программы, в том числе вставка в программу кода всех функций, импортируемых из статических библиотек и/или генерация кода запроса к ОС на загрузку динамических библиотек, из которых программой функции будут вызываться.

Соответственно, программа, осуществляющая компиляцию, называется **компилятором**.

Примеры компиляторов языка **С++**:
1) **g++**, компилятор из набора инструментов (англ. toolchain) GCC;
2) **clang++**, компилятор из набора инструментов LLVM;
3) **cl.exe** - программа-драйвер MSVC (Microsoft Visual C++).

**Компоновщик** (редактор связей, линкер, сборщик) — это программа, которая производит компоновку («линковку», «сборку»): принимает на вход один или несколько объектных модулей и собирает по ним исполнимый модуль.

Примеры компоновщиков:
1) **ld** - из набора инструментов GCC;
2) **lld** - из набора инструментов LLVM;
3) **link.exe** - из набора инструментов MSVC.

**Исходный модуль** - программный модуль на исходном языке, обрабатываемый транслятором.

**Объектный модуль** - двоичный файл, который содержит в себе особым образом подготовленный исполняемый код, который может быть объединён с другими объектными файлами при помощи редактора связей (компоновщика) для получения готового исполняемого модуля, либо библиотеки.

**Исполняемый модуль** (исполняемый файл) — файл, который может быть запущен на исполнение процессором под управлением операционной системы.

**Препроцессор** — программа для обработки текста. Может существовать как отдельная программа, так и быть интегрированной в компилятор. В любом случае, входные и выходные данные для препроцессора имеют текстовый формат. Препроцессор преобразует текст в соответствии с директивами препроцессора. Если текст не содержит директив препроцессора, то текст остаётся без изменений.

В общем виде, сборка программы (С++) производится следующим образом:

1) Исходный модуль обрабатывается **препроцессором**.

    В этой фазе происходит текстовая обработка директив препроцессора (например, `#include "foo/bar.h"` заменит строчку `#include "foo/bar.h"` на содержимое файла по пути `./foo/bar.h`);
2) **Фаза трансляции**.
    **Компилятор** на основе исходного модуля (файл с расширением **.cpp**) с внесенными изменениями создает *объектный модуль*.
3) **Фаза компоновки**.
    Компоновщик собирает один или несколько *объектных модулей*, файлы *статических библиотек* и объединяет их в один исполняемый модуль.

### Процесс компиляции
Компиляция состоит из следующих этапов:
- Лексический анализ - объединение символов в лексемы;
- Синтаксический анализ - построение лексем в дерево разбора;
- Семантический анализ - проверка и построение семантической модели кода;
- Оптимизация - перестроение программы для увеличения ее быстродействия без видимых побочных эффектов;
- Генерация кода - создание итогового объектного модуля. 

### Процесс компоновки (линковки)

В объектном модуле сохраняется информация обо всех определенных функциях и глобальных переменных. Эта информация сведена в таблицу символов (англ. symbol table). При этом производятся необходимые искажения (англ. mangling) имен функций для предотвращения коллизий имен (возникающих, например, при перегрузке функций - в имя кодируются типы аргументов). По таблицам символов компоновщик разрешает межмодульные зависимости, в частности, подставляет реальные адреса функция в места их вызова. Аналогично линкуются и глобальные переменные.